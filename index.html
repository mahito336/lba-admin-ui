<div id="app">
  <p>読み込み中です...</p>
</div>

<script type="module">
  async function init() {
    const app = document.getElementById("app");

    // URLからtenantId取得
    const params = new URLSearchParams(location.search);
    const tenantId = params.get("tenantId");

    if (!tenantId) {
      app.innerHTML = "<p>tenantId が指定されていません。</p>";
      return;
    }

    // lookup API に問い合わせ
    const apiUrl = `https://lba-api.mahito-contact.workers.dev/lookup?tenantId=${tenantId}`;

    let data;
    try {
      const res = await fetch(apiUrl);
      data = await res.json();
    } catch (e) {
      app.innerHTML = "<p>サーバーに接続できません。</p>";
      return;
    }

    // API結果がエラー
    if (!data.ok) {
      app.innerHTML = "<p>テナント情報が取得できません。</p>";
      return;
    }

    // ステータスごとの画面切り替え
    if (data.status === "CANCELLED") {
      app.innerHTML = `<p>契約が終了しています。(${tenantId})</p>`;
      return;
    }

    // READY / ACTIVE / TRIAL → メイン画面表示
    app.innerHTML = `
      <h2>LBA 講師管理ポータル</h2>
      <p>テナントID: ${tenantId}</p>
      <p>プラン: ${data.plan}</p>
      <p>ステータス: ${data.status}</p>
      <p>読み込み成功！ここにダッシュボードを実装していくよ。</p>
    `;
  }

  init();
</script>
