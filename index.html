<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>LBA è¬›å¸«ãƒãƒ¼ã‚¿ãƒ«</title>
  <!-- ã‚¹ãƒãƒ›å‘ã‘ -->
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer onload="onGsiLoaded()"></script>

  <style>
    :root {
      --bg-body: #f3f4f6;
      --bg-card: #ffffff;
      --bg-sidebar: #0f172a;
      --bg-sidebar-active: #1d293b;
      --bg-bottom-nav: #ffffff;
      --border-subtle: #e5e7eb;
      --text-main: #111827;
      --text-sub: #6b7280;
      --text-invert: #f9fafb;
      --accent: #3b82f6;
      --accent-soft: rgba(59, 130, 246, 0.1);
      --danger: #ef4444;
      --radius-card: 14px;
      --shadow-soft: 0 10px 30px rgba(15, 23, 42, 0.08);
      --shadow-bottom-nav: 0 -4px 20px rgba(15, 23, 42, 0.12);
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        "Noto Sans JP", sans-serif;
      color: var(--text-main);
      background: var(--bg-body);
    }

    body {
      display: flex;
      flex-direction: column;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    button {
      font-family: inherit;
    }

    /* ========= å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ========= */

    .card {
      background: var(--bg-card);
      border-radius: var(--radius-card);
      padding: 12px 14px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(148, 163, 184, 0.18);
    }

    /* ========= ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ ========= */

    #login-view {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px 16px;
    }

    .login-card {
      max-width: 420px;
      width: 100%;
      background: #fff;
      border-radius: 16px;
      padding: 24px 20px 20px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.14);
      border: 1px solid rgba(148, 163, 184, 0.35);
    }

    .login-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .login-subtitle {
      font-size: 13px;
      color: var(--text-sub);
      margin-bottom: 18px;
    }

    .login-tenant {
      font-size: 12px;
      padding: 8px 10px;
      border-radius: 10px;
      background: #f9fafb;
      border: 1px dashed #e5e7eb;
      margin-bottom: 16px;
    }

    .login-status {
      font-size: 11px;
      color: var(--text-sub);
      margin-top: 10px;
    }

    .login-footer {
      margin-top: 16px;
      font-size: 11px;
      color: var(--text-sub);
    }

    /* ========= ã‚¢ãƒ—ãƒªæœ¬ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ ========= */

    .app-shell {
      display: flex;
      min-height: 100vh;
    }

    /* --- ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼ˆPCç”¨ / ãƒ¢ãƒã‚¤ãƒ«ã¯ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤ºï¼‰ --- */
    .sidebar {
      width: 240px;
      background: var(--bg-sidebar);
      color: var(--text-invert);
      padding: 16px 14px;
      display: flex;
      flex-direction: column;
      position: fixed;
      top: 0;
      bottom: 0;
      left: 0;
      z-index: 100;
      transform: translateX(0);
      transition: transform 0.2s ease-out;
    }

    .sidebar-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 16px;
    }

    .sidebar-logo {
      width: 28px;
      height: 28px;
      border-radius: 9px;
      background: linear-gradient(135deg, #3b82f6, #6366f1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 16px;
      color: #fff;
    }

    .sidebar-title {
      display: flex;
      flex-direction: column;
      font-size: 13px;
      line-height: 1.3;
    }

    .sidebar-title-main {
      font-weight: 600;
    }

    .sidebar-title-sub {
      font-size: 11px;
      opacity: 0.75;
    }

    .sidebar-section-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.6;
      margin: 12px 6px 4px;
    }

    .sidebar-nav {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .sidebar-nav-item {
      border-radius: 10px;
      padding: 8px 10px;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      opacity: 0.9;
      margin-bottom: 2px;
    }

    .sidebar-nav-item:hover {
      background: rgba(15, 23, 42, 0.5);
    }

    .sidebar-nav-item.active {
      background: var(--bg-sidebar-active);
      opacity: 1;
    }

    .sidebar-nav-icon {
      font-size: 16px;
      width: 18px;
      text-align: center;
    }

    .sidebar-footer {
      margin-top: auto;
      font-size: 11px;
      opacity: 0.7;
      padding: 10px 6px 6px;
      border-top: 1px solid rgba(148, 163, 184, 0.4);
    }

    /* --- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„é ˜åŸŸ --- */
    .main-area {
      flex: 1;
      margin-left: 240px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .topbar {
      position: sticky;
      top: 0;
      z-index: 10;
      background: rgba(243, 244, 246, 0.9);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(148, 163, 184, 0.4);
      padding: 10px 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .topbar-left {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .topbar-title {
      font-size: 16px;
      font-weight: 600;
    }

    .topbar-subtitle {
      font-size: 11px;
      color: var(--text-sub);
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid var(--border-subtle);
      background: #fff;
      color: var(--text-sub);
      gap: 6px;
    }

    .badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent);
    }

    .badge-plan {
      border-color: rgba(59, 130, 246, 0.35);
      background: var(--accent-soft);
      color: #1d4ed8;
    }

    .tenant-id-label {
      font-size: 11px;
      color: var(--text-sub);
    }

    .tenant-id-value {
      font-size: 12px;
      font-weight: 500;
    }

    .topbar-tenant {
      text-align: right;
      font-size: 11px;
    }

    /* --- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æœ¬ä½“ --- */
    .content {
      padding: 18px;
      max-width: 1080px;
      width: 100%;
      margin: 0 auto 90px;
    }

    .view {
      display: none;
    }

    .view-active {
      display: block;
    }

    .card-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 14px;
      margin-bottom: 18px;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
    }

    .card-title {
      font-size: 13px;
      font-weight: 600;
    }

    .card-sub {
      font-size: 11px;
      color: var(--text-sub);
    }

    .card-metric {
      font-size: 20px;
      font-weight: 600;
      margin-top: 4px;
    }

    .card-pill {
      font-size: 11px;
      padding: 2px 7px;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
    }

    .section {
      margin-bottom: 18px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 8px;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
    }

    .section-sub {
      font-size: 11px;
      color: var(--text-sub);
    }

    .guide-list {
      list-style: none;
      padding: 0;
      margin: 0;
      font-size: 13px;
    }

    .guide-list li {
      padding: 6px 0;
      border-bottom: 1px dashed rgba(209, 213, 219, 0.7);
    }

    .guide-list li:last-child {
      border-bottom: none;
    }

    .guide-tag {
      font-size: 11px;
      color: var(--accent);
      background: var(--accent-soft);
      padding: 1px 6px;
      border-radius: 999px;
      margin-left: 4px;
    }

    .alert {
      padding: 10px 12px;
      border-radius: 10px;
      font-size: 12px;
      display: flex;
      gap: 8px;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .alert-info {
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      color: #1d4ed8;
    }

    .alert-error {
      background: #fef2f2;
      border: 1px solid #fecaca;
      color: #b91c1c;
    }

    /* --- ãƒœãƒˆãƒ ãƒŠãƒ“ï¼ˆã‚¹ãƒãƒ›ç”¨ï¼‰ --- */
    .bottom-nav {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      height: 58px;
      background: var(--bg-bottom-nav);
      display: flex;
      border-top: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-bottom-nav);
      z-index: 80;
    }

    .bottom-nav-btn {
      flex: 1;
      border: none;
      background: transparent;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 2px;
      font-size: 10px;
      color: var(--text-sub);
      cursor: pointer;
    }

    .bottom-nav-btn-icon {
      font-size: 17px;
      line-height: 1;
    }

    .bottom-nav-btn.active {
      color: #1d4ed8;
    }

    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.45);
      z-index: 90;
      display: none;
    }

    .overlay.visible {
      display: block;
    }

    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .main-area {
        margin-left: 0;
      }

      .content {
        padding: 14px 12px 90px;
      }

      .card-grid {
        grid-template-columns: 1fr;
      }

      .topbar {
        padding: 8px 12px;
      }

      .topbar-title {
        font-size: 15px;
      }
    }

    @media (min-width: 769px) {
      .bottom-nav {
        display: none;
      }

      .overlay {
        display: none !important;
      }
    }
  </style>
</head>
<body>
  <!-- ãƒ­ã‚°ã‚¤ãƒ³ãƒ“ãƒ¥ãƒ¼ -->
  <div id="login-view">
    <div class="login-card">
      <div class="login-title">è¬›å¸«ãƒãƒ¼ã‚¿ãƒ«ã«ãƒ­ã‚°ã‚¤ãƒ³</div>
      <div class="login-subtitle">
        Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã€ãƒ¬ãƒƒã‚¹ãƒ³ãƒ»äºˆç´„ãƒ»å‹•ç”»å…±æœ‰ã‚’ç®¡ç†ã—ã¾ã™ã€‚
      </div>

      <div class="login-tenant" id="login-tenant-box">
        Tenant ID: <strong id="login-tenant-id">-</strong><br/>
        URL ã« ?tenantId=XXXX ãŒä»˜ã„ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚
      </div>

      <div id="g_id_signin"></div>

      <div class="login-status" id="login-status">
        Google ãƒ­ã‚°ã‚¤ãƒ³å¾Œã€ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®ã¿ãƒãƒ¼ã‚¿ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚
      </div>

      <div class="login-footer">
        â€» å°†æ¥çš„ã«ã¯ã€REGISTRY ã® OWNER_GOOGLE_EMAIL ã¨ç…§åˆã—ã¦è¬›å¸«ã”ã¨ã«ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶é™ã—ã¾ã™ã€‚
      </div>
    </div>
  </div>

  <!-- ãƒ¢ãƒã‚¤ãƒ«æ™‚ï¼šã‚µã‚¤ãƒ‰ãƒãƒ¼ç”¨ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
  <div id="overlay" class="overlay"></div>

  <!-- ã‚¢ãƒ—ãƒªæœ¬ä½“ï¼ˆãƒ­ã‚°ã‚¤ãƒ³å®Œäº†å¾Œã«è¡¨ç¤ºï¼‰ -->
  <div id="app-shell" class="app-shell" style="display:none;">
    <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
    <aside id="sidebar" class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">L</div>
        <div class="sidebar-title">
          <span class="sidebar-title-main">LessonBooking</span>
          <span class="sidebar-title-sub">Instructor Portal</span>
        </div>
      </div>

      <div class="sidebar-section-title">ãƒ¡ã‚¤ãƒ³</div>
      <ul class="sidebar-nav">
        <li class="sidebar-nav-item active" data-view="dashboard">
          <span class="sidebar-nav-icon">ğŸ </span>
          <span>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span>
        </li>
        <li class="sidebar-nav-item" data-view="schedule">
          <span class="sidebar-nav-icon">ğŸ“…</span>
          <span>ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</span>
        </li>
        <li class="sidebar-nav-item" data-view="lessons">
          <span class="sidebar-nav-icon">ğŸ“</span>
          <span>ãƒ¬ãƒƒã‚¹ãƒ³</span>
        </li>
      </ul>

      <div class="sidebar-section-title">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div>
      <div style="padding:6px 6px 0;font-size:11px;line-height:1.5;">
        <div id="sidebar-tenant-status">çŠ¶æ…‹: <strong>èª­ã¿è¾¼ã¿ä¸­...</strong></div>
        <div id="sidebar-tenant-plan">ãƒ—ãƒ©ãƒ³: -</div>
      </div>

      <div class="sidebar-footer">
        <div>Â© Lesson Booking Assistant</div>
        <div style="margin-top:2px;">v0.1 Instructor UI</div>
      </div>
    </aside>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ -->
    <div class="main-area">
      <header class="topbar">
        <div class="topbar-left">
          <div class="topbar-title">è¬›å¸«ãƒãƒ¼ã‚¿ãƒ«</div>
          <div class="topbar-subtitle">
            ãƒ¬ãƒƒã‚¹ãƒ³ãƒ»äºˆç´„ãƒ»å‹•ç”»å…±æœ‰ã‚’ã¾ã¨ã‚ã¦ç®¡ç†
          </div>
        </div>
        <div class="topbar-right">
          <div class="badge badge-plan" id="badge-plan">
            <span>PLAN</span>
          </div>
          <div class="badge" id="badge-status">
            <span class="badge-dot"></span>
            <span id="badge-status-text">èª­ã¿è¾¼ã¿ä¸­...</span>
          </div>
          <div class="topbar-tenant">
            <div class="tenant-id-label">Tenant ID</div>
            <div class="tenant-id-value" id="tenant-id-label">-</div>
            <div style="font-size:10px;color:#6b7280;" id="topbar-user-email"></div>
          </div>
        </div>
      </header>

      <div class="content">
        <div id="alert-area"></div>

        <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
        <section id="view-dashboard" class="view view-active">
          <div class="card-grid">
            <div class="card">
              <div class="card-header">
                <div>
                  <div class="card-title">æœ¬æ—¥ã®ãƒ¬ãƒƒã‚¹ãƒ³</div>
                  <div class="card-sub">ä»Šæ—¥ã®äºˆç´„æ•°ã¨ãƒ¬ãƒƒã‚¹ãƒ³æ•°</div>
                </div>
                <div class="card-pill">Schedule</div>
              </div>
              <div class="card-metric" id="metric-today-lessons">0 ä»¶</div>
            </div>

            <div class="card">
              <div class="card-header">
                <div>
                  <div class="card-title">ä»Šæœˆã®äºˆç´„</div>
                  <div class="card-sub">æš«å®š / ãƒ€ãƒŸãƒ¼è¡¨ç¤º</div>
                </div>
                <div class="card-pill">Reservations</div>
              </div>
              <div class="card-metric" id="metric-month-reservations">--</div>
            </div>

            <div class="card">
              <div class="card-header">
                <div>
                  <div class="card-title">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div>
                  <div class="card-sub">REGISTRY é€£æºçŠ¶æ…‹</div>
                </div>
                <div class="card-pill">Registry</div>
              </div>
              <div class="card-metric" id="metric-status">-</div>
            </div>
          </div>

          <div class="section">
            <div class="section-header">
              <div>
                <div class="section-title">ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰</div>
                <div class="section-sub">
                  ã¾ãšã¯ãƒ¬ãƒƒã‚¹ãƒ³ãƒ»å ´æ‰€ãƒ»è¬›å¸«ã‚’ç™»éŒ²ã—ã¦ã€äºˆç´„ã‚’å—ã‘ä»˜ã‘ã‚‰ã‚Œã‚‹çŠ¶æ…‹ã«ã—ã¾ã™
                </div>
              </div>
            </div>
            <div class="card">
              <ul class="guide-list">
                <li>
                  â‘  ç®¡ç†ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã® <strong>SETTINGS</strong> ã‚·ãƒ¼ãƒˆã‚’ç¢ºèª
                  <span class="guide-tag">å¿…é ˆ</span>
                </li>
                <li>
                  â‘¡ <strong>INSTRUCTORS</strong> / <strong>LOCATIONS</strong> ã«è¬›å¸«ãƒ»å ´æ‰€ã‚’ç™»éŒ²
                </li>
                <li>
                  â‘¢ <strong>LESSONS</strong> ã«ãƒ¬ãƒƒã‚¹ãƒ³ã‚’ç™»éŒ²ã—ã€<strong>SCHEDULES</strong> ã‚’ä½œæˆ
                </li>
                <li>
                  â‘£ å…¬é–‹äºˆç´„ãƒšãƒ¼ã‚¸ï¼ˆURLï¼‰ã¯ REGISTRY ã®
                  <strong>PUBLIC_BOOKING_URL</strong> ã‚’åˆ©ç”¨
                </li>
              </ul>
            </div>
          </div>
        </section>

        <!-- ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« -->
        <section id="view-schedule" class="view">
          <div class="section">
            <div class="section-header">
              <div>
                <div class="section-title">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</div>
                <div class="section-sub">
                  ã“ã“ã«ã€Œé€±ãƒ“ãƒ¥ãƒ¼ã€ã€Œãƒªã‚¹ãƒˆè¡¨ç¤ºã€ãªã©ã‚’è¿½åŠ äºˆå®š
                </div>
              </div>
            </div>
            <div class="card">
              <p style="font-size:13px;margin:0 0 8px;">
                ç¾æ™‚ç‚¹ã§ã¯ UI ã‚·ã‚§ãƒ«ã®ã¿ã€‚ä»Šå¾Œã€
                <strong>SCHEDULESã‚·ãƒ¼ãƒˆ</strong> ã¨é€£æºã—ã¦è¡¨ç¤ºãƒ»ç·¨é›†ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚
              </p>
              <p style="font-size:13px;margin:0;">
                TODO:
                é€±ãƒ“ãƒ¥ãƒ¼ãƒ»1æ—¥ãƒ“ãƒ¥ãƒ¼ãƒ»ãƒ¬ãƒƒã‚¹ãƒ³è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ«â€¦ç­‰ã‚’ã“ã“ã«è¼‰ã›ã¦ã„ãã€‚
              </p>
            </div>
          </div>
        </section>

        <!-- ãƒ¬ãƒƒã‚¹ãƒ³ -->
        <section id="view-lessons" class="view">
          <div class="section">
            <div class="section-header">
              <div>
                <div class="section-title">ãƒ¬ãƒƒã‚¹ãƒ³ç®¡ç†</div>
                <div class="section-sub">
                  ãƒ¬ãƒƒã‚¹ãƒ³ä¸€è¦§ã¨ç·¨é›† UI ã‚’ã“ã“ã«å®Ÿè£…äºˆå®š
                </div>
              </div>
            </div>
            <div class="card">
              <p style="font-size:13px;margin:0 0 8px;">
                ç¾æ™‚ç‚¹ã§ã¯ã€LESSONS ã‚·ãƒ¼ãƒˆã¨é€£æºã—ãŸ UI ã®åœŸå°ã¨ã—ã¦ã‚«ãƒ¼ãƒ‰ã‚’ç”¨æ„ã€‚
              </p>
              <p style="font-size:13px;margin:0;">
                TODO:
                ãƒ¬ãƒƒã‚¹ãƒ³ä¸€è¦§ / æ–°è¦ä½œæˆ / ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ / æ–™é‡‘ / ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒãƒªã‚·ãƒ¼
                ãªã©ã‚’ãƒ•ã‚©ãƒ¼ãƒ ãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«ã§å®Ÿè£…ã€‚
              </p>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>

  <!-- ãƒœãƒˆãƒ ãƒŠãƒ“ï¼ˆã‚¹ãƒãƒ›å°‚ç”¨ï¼‰ -->
  <nav class="bottom-nav">
    <button class="bottom-nav-btn active" data-view="dashboard">
      <span class="bottom-nav-btn-icon">ğŸ </span>
      <span>ãƒ›ãƒ¼ãƒ </span>
    </button>
    <button class="bottom-nav-btn" data-view="schedule">
      <span class="bottom-nav-btn-icon">ğŸ“…</span>
      <span>ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</span>
    </button>
    <button class="bottom-nav-btn" data-view="lessons">
      <span class="bottom-nav-btn-icon">ğŸ“</span>
      <span>ãƒ¬ãƒƒã‚¹ãƒ³</span>
    </button>
    <button class="bottom-nav-btn" data-role="menu">
      <span class="bottom-nav-btn-icon">â˜°</span>
      <span>ãƒ¡ãƒ‹ãƒ¥ãƒ¼</span>
    </button>
  </nav>

  <script>
    // ========= å…±é€šå¤‰æ•° =========
    let currentUserEmail = null;

    // ========================
    // ã‚¯ã‚¨ãƒªã‹ã‚‰ tenantId ã‚’å–å¾—
    // ========================
    function getTenantIdFromUrl() {
      const params = new URLSearchParams(window.location.search);
      return params.get("tenantId") || "";
    }

    // ========================
    // REGISTRY lookup å‘¼ã³å‡ºã—
    // ========================
    async function fetchTenantInfo(tenantId) {
      const url =
        "https://api.lba.mahito.app/lookup?tenantId=" +
        encodeURIComponent(tenantId);

      const res = await fetch(url, { method: "GET" });
      return await res.json();
    }

    // ========================
    // UI æ›´æ–°é–¢é€£
    // ========================
    function setAlert(message, type) {
      const alertArea = document.getElementById("alert-area");
      alertArea.innerHTML = "";

      if (!message) return;

      const div = document.createElement("div");
      div.className = "alert " + (type === "error" ? "alert-error" : "alert-info");
      div.innerHTML = `<span style="font-size:14px;">â„¹ï¸</span><span>${message}</span>`;
      alertArea.appendChild(div);
    }

    function updateTenantUI(tenantId, info) {
      const tenantIdLabel = document.getElementById("tenant-id-label");
      tenantIdLabel.textContent = tenantId || "-";

      const badgePlan = document.getElementById("badge-plan");
      const badgeStatusText = document.getElementById("badge-status-text");

      const sidebarStatus = document.getElementById("sidebar-tenant-status");
      const sidebarPlan = document.getElementById("sidebar-tenant-plan");
      const metricStatus = document.getElementById("metric-status");

      if (!info || !info.ok) {
        badgePlan.textContent = "PLAN -";
        badgeStatusText.textContent = "ãƒ†ãƒŠãƒ³ãƒˆæœªç™»éŒ²";
        sidebarStatus.innerHTML = "çŠ¶æ…‹: <strong>æœªç™»éŒ²</strong>";
        sidebarPlan.textContent = "ãƒ—ãƒ©ãƒ³: -";
        metricStatus.textContent = "NOT FOUND";
        setAlert("REGISTRY ã«ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚", "error");
        return;
      }

      const plan = info.plan || "-";
      const status = info.status || "-";

      badgePlan.textContent = "PLAN " + plan.toUpperCase();
      badgeStatusText.textContent = status;

      sidebarStatus.innerHTML = "çŠ¶æ…‹: <strong>" + status + "</strong>";
      sidebarPlan.textContent = "ãƒ—ãƒ©ãƒ³: " + plan;

      metricStatus.textContent = status;

      if (status === "READY") {
        setAlert(
          "ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†æ¸ˆã¿ã§ã™ã€‚ã“ã®ãƒãƒ¼ã‚¿ãƒ«ã‹ã‚‰ãƒ¬ãƒƒã‚¹ãƒ³ã‚„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ç™»éŒ²ã‚’é€²ã‚ã¦ãã ã•ã„ã€‚",
          "info"
        );
      } else if (status === "ACTIVE" || status === "TRIAL") {
        setAlert(
          "Stripe ã®å¥‘ç´„ã¯æœ‰åŠ¹ã§ã™ã€‚ç’°å¢ƒæ§‹ç¯‰ï¼ˆprovisionï¼‰ãŒã¾ã ã®å ´åˆã¯ã€ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ¡ãƒ¼ãƒ«ã®ãƒªãƒ³ã‚¯ã‹ã‚‰å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚",
          "info"
        );
      } else if (status === "CANCELLED") {
        setAlert(
          "ã“ã®ãƒ†ãƒŠãƒ³ãƒˆã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«çŠ¶æ…‹ã§ã™ã€‚å¿…è¦ã«å¿œã˜ã¦å†å¥‘ç´„ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚",
          "error"
        );
      }
    }

    // ========================
    // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶å¾¡
    // ========================
    function activateView(viewName) {
      document.querySelectorAll(".view").forEach((el) => {
        el.classList.remove("view-active");
      });
      const target = document.getElementById("view-" + viewName);
      if (target) target.classList.add("view-active");

      document.querySelectorAll(".sidebar-nav-item").forEach((el) => {
        const v = el.getAttribute("data-view");
        el.classList.toggle("active", v === viewName);
      });

      document.querySelectorAll(".bottom-nav-btn").forEach((el) => {
        const v = el.getAttribute("data-view");
        const role = el.getAttribute("data-role");
        if (v) {
          el.classList.toggle("active", v === viewName);
        } else if (role === "menu") {
          el.classList.remove("active");
        }
      });
    }

    function setupNavigation() {
      const sidebar = document.getElementById("sidebar");
      const overlay = document.getElementById("overlay");

      document.querySelectorAll(".sidebar-nav-item").forEach((el) => {
        el.addEventListener("click", () => {
          const view = el.getAttribute("data-view");
          activateView(view);
          sidebar.classList.remove("open");
          overlay.classList.remove("visible");
        });
      });

      document.querySelectorAll(".bottom-nav-btn").forEach((btn) => {
        const view = btn.getAttribute("data-view");
        const role = btn.getAttribute("data-role");

        if (view) {
          btn.addEventListener("click", () => {
            activateView(view);
          });
        } else if (role === "menu") {
          btn.addEventListener("click", () => {
            sidebar.classList.toggle("open");
            overlay.classList.toggle("visible");
          });
        }
      });

      overlay.addEventListener("click", () => {
        sidebar.classList.remove("open");
        overlay.classList.remove("visible");
      });
    }

    // ========================
    // ãƒãƒ¼ã‚¿ãƒ«åˆæœŸåŒ–ï¼ˆãƒ­ã‚°ã‚¤ãƒ³å¾Œã«å‘¼ã¶ï¼‰
    // ========================
    async function initPortal() {
      setupNavigation();

      const tenantId = getTenantIdFromUrl();
      const loginTenantIdEl = document.getElementById("login-tenant-id");
      loginTenantIdEl.textContent = tenantId || "-";

      if (!tenantId) {
        updateTenantUI("", null);
        setAlert("URL ã« ?tenantId=XXXX ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚", "error");
        return;
      }

      try {
        const info = await fetchTenantInfo(tenantId);
        updateTenantUI(tenantId, info);

        const todayEl = document.getElementById("metric-today-lessons");
        const monthEl = document.getElementById("metric-month-reservations");
        todayEl.textContent = "â€” ä»¶";
        monthEl.textContent = "â€” ä»¶";
      } catch (err) {
        console.error(err);
        updateTenantUI(tenantId, null);
        setAlert(
          "ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰å†åº¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚",
          "error"
        );
      }
    }

    // ========================
    // ã‚¨ãƒ©ãƒ¼è¡¨ç¤º (ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ç”¨)
    // ========================
    function showError(msg) {
      const statusEl = document.getElementById("login-status");
      statusEl.style.color = "#b91c1c";
      statusEl.textContent = msg;
    }

    // ========================
    // JWT ãƒ‘ãƒ¼ã‚µãƒ¼ï¼ˆdecodeJwtResponse ã®ä»£ç”¨ï¼‰
    // ========================
    function parseJwt (token) {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const jsonPayload = decodeURIComponent(
        atob(base64)
          .split('')
          .map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))
          .join('')
      );

      return JSON.parse(jsonPayload);
    }

    // ========================
    // Google Identity callback
    // ========================
    function handleCredentialResponse(response) {
      try {
        const decoded = parseJwt(response.credential);

        const email = decoded.email;
        if (!email) {
          showError("Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ¡ãƒ¼ãƒ«å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
          return;
        }

        // èªè¨¼æˆåŠŸ â†’ REGISTRY lookup â†’ admin UIã¸é€²ã‚€
        proceedAfterLogin(email);

      } catch (e) {
        console.error(e);
        showError("èªè¨¼æƒ…å ±ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
      }
    }

  
    // ========================
    // ãƒ­ã‚°ã‚¤ãƒ³å¾Œã®å‡¦ç†
    // ========================
    async function proceedAfterLogin(email) {
      currentUserEmail = email;
  
      // ç”»é¢ã«è¡¨ç¤ºï¼ˆå³ä¸Šï¼‰
      try {
        document.getElementById("topbar-user-email").textContent = email;
      } catch (e) {}
  
      const tenantId = getTenantIdFromUrl();
      if (!tenantId) {
        showError("tenantId ãŒ URL ã«ã‚ã‚Šã¾ã›ã‚“ã€‚");
        return;
      }
  
      // REGISTRY ã® STATUS ãªã©ã‚’èª­ã¿è¾¼ã¿
      try {
        const info = await fetchTenantInfo(tenantId);
  
        if (!info || !info.ok) {
          showError("ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚");
          return;
        }
  
        //ï¼ˆå°†æ¥çš„ã«ï¼‰OWNER_GOOGLE_EMAIL ã¨ç…§åˆã—ã¦ã“ã“ã§ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
        if (info.ownerEmail && info.ownerEmail !== email) {
          showError("ã“ã® Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã¯ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã€‚");
          return;
        }
  
        // ãƒ­ã‚°ã‚¤ãƒ³ãƒ“ãƒ¥ãƒ¼éè¡¨ç¤º â†’ ã‚¢ãƒ—ãƒªè¡¨ç¤º
        document.getElementById("login-view").style.display = "none";
        document.getElementById("app-shell").style.display = "flex";
  
        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰åˆæœŸåŒ–
        initPortal();
  
      } catch (err) {
        console.error(err);
        showError("ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
      }
    }    

   
    // ========================
    // GSI åˆæœŸåŒ–
    // ========================
    function onGsiLoaded() {
      const tenantId = getTenantIdFromUrl();
      document.getElementById("login-tenant-id").textContent = tenantId || "-";

      google.accounts.id.initialize({
        client_id: "990347544512-fo61ah4puh71pdvbnna2ercsngha6r2f.apps.googleusercontent.com",
        callback: handleCredentialResponse,
      });

      google.accounts.id.renderButton(
        document.getElementById("g_id_signin"),
        { theme: "outline", size: "large", shape: "pill", text: "continue_with" }
      );
    }

  </script>
</body>
</html>
