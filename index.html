<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>LBA è¬›å¸«ãƒãƒ¼ã‚¿ãƒ«</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <style>
    :root {
      --bg: #f5f5f7;
      --bg-elevated: #ffffff;
      --border-subtle: #e3e3ea;
      --accent: #2563eb;
      --accent-soft: #dbeafe;
      --text-main: #111827;
      --text-sub: #6b7280;
      --danger: #dc2626;
      --radius-lg: 16px;
      --radius-md: 10px;
      --shadow-soft: 0 12px 30px rgba(15,23,42,0.08);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        "Noto Sans JP", sans-serif;
      background: var(--bg);
      color: var(--text-main);
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    .app-shell {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ----- Top bar ----- */
    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 18px;
      border-bottom: 1px solid var(--border-subtle);
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(8px);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .brand-mark {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      border: 2px solid var(--accent);
      position: relative;
      box-shadow: 0 0 0 2px rgba(37,99,235,0.2);
    }

    .brand-mark::after {
      content: "";
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: var(--accent);
      top: 50%;
      left: 58%;
      transform: translate(-50%,-50%);
    }

    .brand-title {
      font-weight: 600;
      font-size: 15px;
    }

    .brand-sub {
      font-size: 11px;
      color: var(--text-sub);
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 11px;
      color: var(--text-sub);
    }

    .pill {
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid var(--border-subtle);
      background: #fff;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .pill-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent);
    }

    .pill-danger .pill-dot {
      background: var(--danger);
    }

    .btn-outline {
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      padding: 5px 10px;
      font-size: 11px;
      background: #fff;
      cursor: pointer;
    }

    .btn-outline:hover {
      border-color: var(--accent);
    }

    /* ----- Layout ----- */
    .layout {
      display: flex;
      flex: 1;
      min-height: 0;
    }

    .sidebar {
      width: 220px;
      padding: 18px 12px 18px 16px;
      border-right: 1px solid var(--border-subtle);
      background: #fcfcff;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .sidebar-section-label {
      font-size: 11px;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: var(--text-sub);
      padding: 0 8px;
    }

    .nav-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .nav-item {
      border-radius: 999px;
      padding: 7px 10px;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      color: var(--text-sub);
    }

    .nav-item span.icon {
      font-size: 15px;
      width: 18px;
      text-align: center;
    }

    .nav-item.active {
      background: var(--accent-soft);
      color: var(--accent);
      font-weight: 600;
    }

    .nav-item:hover {
      background: rgba(148,163,184,0.15);
    }

    .sidebar-footer {
      margin-top: auto;
      font-size: 11px;
      color: var(--text-sub);
      padding: 0 8px;
    }

    .sidebar-footer small {
      display: block;
    }

    /* ----- Main area ----- */
    .main {
      flex: 1;
      padding: 18px 20px 32px;
      min-width: 0;
    }

    .status-banner {
      border-radius: var(--radius-lg);
      padding: 10px 12px;
      background: var(--accent-soft);
      border: 1px solid rgba(37,99,235,0.25);
      font-size: 12px;
      margin-bottom: 12px;
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: center;
    }

    .status-banner .left {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .status-banner strong {
      font-size: 13px;
    }

    .status-banner .right {
      white-space: nowrap;
      font-size: 11px;
      color: var(--text-sub);
    }

    .cards {
      display: grid;
      grid-template-columns: minmax(0,2fr) minmax(0,1.4fr);
      gap: 16px;
    }

    .card {
      background: var(--bg-elevated);
      border-radius: var(--radius-lg);
      padding: 14px 14px 16px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(15,23,42,0.03);
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .card-sub {
      font-size: 11px;
      color: var(--text-sub);
      margin-bottom: 10px;
    }

    .next-steps {
      list-style: none;
      margin: 0;
      padding: 0;
      font-size: 13px;
    }

    .next-steps li {
      padding: 4px 0;
      display: flex;
      gap: 8px;
      align-items: flex-start;
    }

    .next-steps li span.bullet {
      margin-top: 4px;
      font-size: 14px;
      color: var(--accent);
    }

    .meta-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 8px 12px;
      font-size: 12px;
    }

    .meta-key {
      color: var(--text-sub);
    }

    .meta-val {
      font-weight: 500;
    }

    .muted {
      color: var(--text-sub);
      font-size: 12px;
    }

    .error-box,
    .empty-box {
      max-width: 520px;
      margin: 30px auto;
      text-align: center;
      padding: 18px 16px 22px;
      border-radius: var(--radius-lg);
      background: #fef2f2;
      color: var(--danger);
      border: 1px solid rgba(239,68,68,0.4);
      box-shadow: var(--shadow-soft);
    }

    .error-box h2,
    .empty-box h2 {
      margin: 0 0 6px;
      font-size: 15px;
    }

    .error-box p,
    .empty-box p {
      margin: 0;
      font-size: 12px;
      color: #991b1b;
    }

    .empty-box {
      background: #eff6ff;
      color: var(--text-main);
      border-color: rgba(37,99,235,0.3);
    }

    .view-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .view-sub {
      font-size: 12px;
      color: var(--text-sub);
      margin-bottom: 16px;
    }

    .placeholder-box {
      border-radius: var(--radius-md);
      border: 1px dashed var(--border-subtle);
      padding: 14px;
      font-size: 12px;
      color: var(--text-sub);
      background: rgba(248,250,252,0.9);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      padding: 2px 8px;
      font-size: 11px;
      background: #fff;
    }

    .badge strong {
      font-weight: 600;
    }

    .loading {
      font-size: 13px;
      color: var(--text-sub);
      padding: 20px;
      text-align: center;
    }

    @media (max-width: 880px) {
      .layout {
        flex-direction: column;
      }
      .sidebar {
        width: 100%;
        flex-direction: row;
        align-items: center;
        overflow-x: auto;
        padding: 10px 12px;
        border-right: none;
        border-bottom: 1px solid var(--border-subtle);
      }
      .sidebar-section-label {
        display: none;
      }
      .nav-list {
        flex-direction: row;
        gap: 6px;
      }
      .nav-item {
        white-space: nowrap;
      }
      .sidebar-footer {
        display: none;
      }
      .main {
        padding: 16px 14px 24px;
      }
      .cards {
        grid-template-columns: minmax(0,1fr);
      }
    }
  </style>
</head>
<body>
<div class="app-shell">
  <header class="topbar">
    <div class="brand">
      <div class="brand-mark"></div>
      <div>
        <div class="brand-title">Lesson Booking Assistant</div>
        <div class="brand-sub">LBA è¬›å¸«ãƒãƒ¼ã‚¿ãƒ«</div>
      </div>
    </div>
    <div class="topbar-right">
      <div id="top-tenant-pill" class="pill" style="display:none;">
        <span class="pill-dot"></span>
        <span id="top-tenant-text"></span>
      </div>
      <button id="btn-open-public" class="btn-outline" style="display:none;">
        å—è¬›è€…ç”¨ãƒšãƒ¼ã‚¸ã‚’é–‹ã
      </button>
    </div>
  </header>

  <div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-section-label">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
      <ul class="nav-list" id="nav-list">
        <li class="nav-item active" data-view="dashboard">
          <span class="icon">ğŸ </span>
          <span>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span>
        </li>
        <li class="nav-item" data-view="lessons">
          <span class="icon">ğŸ“˜</span>
          <span>ãƒ¬ãƒƒã‚¹ãƒ³</span>
        </li>
        <li class="nav-item" data-view="schedules">
          <span class="icon">ğŸ“…</span>
          <span>ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</span>
        </li>
        <li class="nav-item" data-view="reservations">
          <span class="icon">ğŸ§¾</span>
          <span>äºˆç´„ç®¡ç†</span>
        </li>
        <li class="nav-item" data-view="videos">
          <span class="icon">ğŸ¬</span>
          <span>å‹•ç”»å…±æœ‰</span>
        </li>
        <li class="nav-item" data-view="settings">
          <span class="icon">âš™ï¸</span>
          <span>è¨­å®š</span>
        </li>
      </ul>

      <div class="sidebar-footer">
        <small id="sidebar-tenant"></small>
        <small id="sidebar-plan"></small>
      </div>
    </aside>

    <!-- Main content -->
    <main class="main">
      <div id="main-root">
        <div class="loading">ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­ã§ã™â€¦</div>
      </div>
    </main>
  </div>
</div>

<script>
  const state = {
    tenantId: null,
    data: null,
    currentView: "dashboard",
  };

  function formatStatusLabel(status) {
    if (!status) return "çŠ¶æ…‹: ä¸æ˜";
    if (status === "READY") return "çŠ¶æ…‹: æº–å‚™å®Œäº† (READY)";
    if (status === "ACTIVE") return "çŠ¶æ…‹: å¥‘ç´„ä¸­ (ACTIVE)";
    if (status === "TRIAL") return "çŠ¶æ…‹: ãƒˆãƒ©ã‚¤ã‚¢ãƒ«ä¸­ (TRIAL)";
    if (status === "CANCELLED") return "çŠ¶æ…‹: å¥‘ç´„çµ‚äº† (CANCELLED)";
    return "çŠ¶æ…‹: " + status;
  }

  function formatPlanLabel(plan) {
    if (!plan) return "ãƒ—ãƒ©ãƒ³: ä¸æ˜";
    const label =
      plan.toLowerCase() === "simple" ? "Simple" :
      plan.toLowerCase() === "standard" ? "Standard" :
      plan;
    return "ãƒ—ãƒ©ãƒ³: " + label;
  }

  function renderError(title, message) {
    const root = document.getElementById("main-root");
    root.innerHTML = `
      <div class="error-box">
        <h2>${title}</h2>
        <p>${message}</p>
      </div>
    `;
  }

  function renderCancelled(tenantId) {
    const root = document.getElementById("main-root");
    root.innerHTML = `
      <div class="error-box">
        <h2>å¥‘ç´„ãŒçµ‚äº†ã—ã¦ã„ã¾ã™</h2>
        <p>ã“ã®ãƒ†ãƒŠãƒ³ãƒˆ (<strong>${tenantId}</strong>) ã¯ <strong>CANCELLED</strong> çŠ¶æ…‹ã§ã™ã€‚</p>
        <p>ã”ä¸æ˜ãªç‚¹ãŒã‚ã‚Œã°ã€é‹å–¶è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚</p>
      </div>
    `;
  }

  function renderDashboard() {
    const root = document.getElementById("main-root");
    const d = state.data || {};
    const planText = formatPlanLabel(d.plan);
    const statusText = formatStatusLabel(d.status);

    root.innerHTML = `
      <div>
        <div class="status-banner">
          <div class="left">
            <strong>ã‚ˆã†ã“ãã€LBA ç®¡ç†ãƒãƒ¼ã‚¿ãƒ«ã¸</strong>
            <span>ãƒ¬ãƒƒã‚¹ãƒ³ç™»éŒ²ãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†ãƒ»äºˆç´„ç®¡ç†ãƒ»å‹•ç”»å…±æœ‰ã‚’ã“ã“ã‹ã‚‰è¡Œãˆã¾ã™ã€‚</span>
          </div>
          <div class="right">
            <div class="badge">
              <strong>${planText.replace("ãƒ—ãƒ©ãƒ³: ","")}</strong>
              <span>|</span>
              <span>${d.status || "UNKNOWN"}</span>
            </div>
          </div>
        </div>

        <div class="cards">
          <section class="card">
            <div class="card-title">æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</div>
            <div class="card-sub">ã¾ãšã¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’ç¢ºèªã—ã€ãƒ¬ãƒƒã‚¹ãƒ³ãƒ»å ´æ‰€ãƒ»è¬›å¸«ã‚’ç™»éŒ²ã—ã¾ã—ã‚‡ã†ã€‚</div>
            <ul class="next-steps">
              <li>
                <span class="bullet">1.</span>
                <div>
                  <strong>Google ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’é–‹ã</strong><br>
                  <span class="muted">ã€ŒLBA_TEACHER_${state.tenantId}ã€ã¨ã„ã†åå‰ã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãŒ Drive ã«ä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚</span>
                </div>
              </li>
              <li>
                <span class="bullet">2.</span>
                <div>
                  <strong>INSTRUCTORS / LOCATIONS / LESSONS ã‚·ãƒ¼ãƒˆã‚’è¨­å®š</strong><br>
                  <span class="muted">è¬›å¸«ãƒ»å ´æ‰€ãƒ»ãƒ¬ãƒƒã‚¹ãƒ³ã®åŸºæœ¬ãƒã‚¹ã‚¿ã‚’ç™»éŒ²ã—ã¾ã™ã€‚</span>
                </div>
              </li>
              <li>
                <span class="bullet">3.</span>
                <div>
                  <strong>SCHEDULES ã‚·ãƒ¼ãƒˆã§å®Ÿéš›ã®é–‹å‚¬æ—¥ã‚’ç™»éŒ²</strong><br>
                  <span class="muted">ã“ã“ã§ç™»éŒ²ã—ãŸã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã€å—è¬›è€…ç”¨ã®äºˆç´„ãƒšãƒ¼ã‚¸ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</span>
                </div>
              </li>
            </ul>
          </section>

          <section class="card">
            <div class="card-title">å¥‘ç´„æƒ…å ±</div>
            <div class="card-sub">ç¾åœ¨ã®ãƒ†ãƒŠãƒ³ãƒˆçŠ¶æ…‹ã®æ¦‚è¦ã§ã™ã€‚</div>
            <div class="meta-grid">
              <div class="meta-key">ãƒ†ãƒŠãƒ³ãƒˆID</div>
              <div class="meta-val">${state.tenantId}</div>

              <div class="meta-key">ãƒ—ãƒ©ãƒ³</div>
              <div class="meta-val">${planText.replace("ãƒ—ãƒ©ãƒ³: ","")}</div>

              <div class="meta-key">çŠ¶æ…‹</div>
              <div class="meta-val">${d.status || "ä¸æ˜"}</div>

              <div class="meta-key">å—è¬›è€…ç”¨URL</div>
              <div class="meta-val">
                ${d.publicBookingUrl
                  ? `<a href="${d.publicBookingUrl}" target="_blank" rel="noopener">ãƒªãƒ³ã‚¯ã‚’é–‹ã</a>`
                  : "æœªè¨­å®š"}
              </div>

              <div class="meta-key">è¬›å¸«ãƒãƒ¼ã‚¿ãƒ«URL</div>
              <div class="meta-val">
                ${d.portalUrl
                  ? `<a href="${d.portalUrl}" target="_blank" rel="noopener">ã“ã®ãƒšãƒ¼ã‚¸ã®å…±æœ‰ãƒªãƒ³ã‚¯</a>`
                  : "æœªè¨­å®š"}
              </div>

              <div class="meta-key">ãƒ¡ãƒ¢</div>
              <div class="meta-val">Stripe / REGISTRY ã¨é€£æºã—ã¦å¥‘ç´„çŠ¶æ…‹ã‚’è‡ªå‹•ç®¡ç†ã—ã¾ã™ã€‚</div>
            </div>
          </section>
        </div>
      </div>
    `;
  }

  function renderPlaceholderView(viewName) {
    const root = document.getElementById("main-root");
    const labelMap = {
      lessons: "ãƒ¬ãƒƒã‚¹ãƒ³",
      schedules: "ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«",
      reservations: "äºˆç´„ç®¡ç†",
      videos: "å‹•ç”»å…±æœ‰",
      settings: "è¨­å®š",
    };
    const title = labelMap[viewName] || viewName;

    root.innerHTML = `
      <section>
        <div class="view-title">${title}</div>
        <div class="view-sub">
          ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯ã“ã‚Œã‹ã‚‰å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚ã¾ãšã¯ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§å…¨ä½“ã®æµã‚Œã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
        </div>
        <div class="placeholder-box">
          ${viewName === "lessons" ? `
            ãƒ»LESSONS ã‚·ãƒ¼ãƒˆã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä¸€è¦§è¡¨ç¤ºã—ã€ã“ã“ã‹ã‚‰ç·¨é›†ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹äºˆå®šã§ã™ã€‚<br>
            ãƒ»ã€Œãƒ¬ãƒƒã‚¹ãƒ³è¿½åŠ ã€ãƒœã‚¿ãƒ³ã§ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè¡Œã‚’ç”Ÿæˆã—ã€ã‚·ãƒ¼ãƒˆã«æ›¸ãè¾¼ã‚€è¨­è¨ˆã‚‚å¯èƒ½ã§ã™ã€‚
          ` : ""}
          ${viewName === "schedules" ? `
            ãƒ»SCHEDULES ã‚·ãƒ¼ãƒˆã¨é€£æºã—ã€é€±è¡¨ç¤ºãƒ»æœˆè¡¨ç¤ºã§äºˆå®šã‚’ç¢ºèªã§ãã‚‹UIã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚<br>
            ãƒ»ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚„ã€æ‰‹å‹•äºˆç´„è¿½åŠ ãƒ•ãƒ­ãƒ¼ã«ã¤ãªã’ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
          ` : ""}
          ${viewName === "reservations" ? `
            ãƒ»RESERVATIONS ã‚·ãƒ¼ãƒˆã¨é€£å‹•ã—ã€æ—¥ä»˜ã‚„ãƒ¬ãƒƒã‚¹ãƒ³å˜ä½ã§äºˆç´„ä¸€è¦§ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚<br>
            ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´ï¼ˆä»®äºˆç´„â†’æœ¬äºˆç´„ã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼‰ã‚„ã€æ‰‹å‹•è¿½åŠ ã‚’ã“ã“ã‹ã‚‰è¡Œãˆã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
          ` : ""}
          ${viewName === "videos" ? `
            ãƒ»VIDEOS ã‚·ãƒ¼ãƒˆé€£æºã§ã€ãƒ¬ãƒƒã‚¹ãƒ³ã”ã¨ã®å‹•ç”»å…±æœ‰ãƒªãƒ³ã‚¯ãƒ»æœŸé™ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ç®¡ç†ã—ã¾ã™ã€‚<br>
            ãƒ»æœŸé™åˆ‡ã‚Œè‡ªå‹•å‰Šé™¤ã‚„ã€å—è¬›è€…ã¸ã®ä¸€æ–‰é€ä¿¡æ©Ÿèƒ½ã‚’ã“ã“ã«ã¾ã¨ã‚ã‚‹æƒ³å®šã§ã™ã€‚
          ` : ""}
          ${viewName === "settings" ? `
            ãƒ»SETTINGS ã‚·ãƒ¼ãƒˆã®å„ç¨®è¨­å®šï¼ˆå‹•ç”»ä¿å­˜æœŸé–“ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡å¯å¦ãªã©ï¼‰ã‚’UIã‹ã‚‰å¤‰æ›´ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹äºˆå®šã§ã™ã€‚<br>
            ãƒ»ãƒ†ãƒŠãƒ³ãƒˆãƒ—ãƒ©ãƒ³ã‚„ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã®ç¢ºèªã‚‚ã“ã“ã§è¡Œãˆã¾ã™ã€‚
          ` : ""}
        </div>
      </section>
    `;
  }

  function setActiveNav(view) {
    const items = document.querySelectorAll(".nav-item");
    items.forEach((el) => {
      if (el.dataset.view === view) {
        el.classList.add("active");
      } else {
        el.classList.remove("active");
      }
    });
  }

  function renderView(view) {
    state.currentView = view;
    setActiveNav(view);

    if (!state.data) {
      const root = document.getElementById("main-root");
      root.innerHTML = '<div class="loading">ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­ã§ã™â€¦</div>';
      return;
    }

    if (view === "dashboard") {
      renderDashboard();
    } else {
      renderPlaceholderView(view);
    }
  }

  async function init() {
    const params = new URLSearchParams(location.search);
    const tenantId = params.get("tenantId");

    const root = document.getElementById("main-root");
    const pill = document.getElementById("top-tenant-pill");
    const pillText = document.getElementById("top-tenant-text");
    const btnPublic = document.getElementById("btn-open-public");
    const sidebarTenant = document.getElementById("sidebar-tenant");
    const sidebarPlan = document.getElementById("sidebar-plan");

    if (!tenantId) {
      renderError("tenantId ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“",
        "URL ã« ?tenantId=XXXX ã®å½¢å¼ã§ãƒ†ãƒŠãƒ³ãƒˆIDã‚’ä»˜ã‘ã¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚");
      return;
    }

    state.tenantId = tenantId;
    root.innerHTML = '<div class="loading">ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­ã§ã™â€¦</div>';

    const apiUrl = `https://lba-api.mahito-contact.workers.dev/lookup?tenantId=${encodeURIComponent(tenantId)}`;

    let data;
    try {
      const res = await fetch(apiUrl, { method: "GET" });
      data = await res.json();
    } catch (err) {
      console.error(err);
      renderError("ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“",
        "æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚");
      return;
    }

    if (!data || !data.ok) {
      renderError("ãƒ†ãƒŠãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",
        `ãƒ†ãƒŠãƒ³ãƒˆIDã€Œ${tenantId}ã€ã¯ REGISTRY ã«ç™»éŒ²ã•ã‚Œã¦ã„ãªã„ã‹ã€å‚ç…§ã§ãã¾ã›ã‚“ã€‚`);
      return;
    }

    // CANCELLED ã¯å°‚ç”¨ç”»é¢
    if (data.status === "CANCELLED") {
      state.data = data;
      pill.style.display = "inline-flex";
      pill.classList.add("pill-danger");
      pillText.textContent = `${tenantId} / CANCELLED`;
      sidebarTenant.textContent = `Tenant: ${tenantId}`;
      sidebarPlan.textContent = formatPlanLabel(data.plan);
      renderCancelled(tenantId);
      return;
    }

    // READY / ACTIVE / TRIAL â†’ é€šå¸¸ç”»é¢
    state.data = data;

    // Top bar
    pill.style.display = "inline-flex";
    pillText.textContent = `${tenantId} / ${data.status || "UNKNOWN"}`;

    // å—è¬›è€…ç”¨ãƒšãƒ¼ã‚¸ãƒœã‚¿ãƒ³
    if (data.publicBookingUrl) {
      btnPublic.style.display = "inline-block";
      btnPublic.onclick = () => {
        window.open(data.publicBookingUrl, "_blank", "noopener");
      };
    }

    // Sidebar footer
    sidebarTenant.textContent = `Tenant: ${tenantId}`;
    sidebarPlan.textContent = formatPlanLabel(data.plan);

    // åˆæœŸè¡¨ç¤º
    renderView("dashboard");
  }

  // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆ
  document.addEventListener("click", (e) => {
    const item = e.target.closest(".nav-item");
    if (!item) return;
    const view = item.dataset.view;
    if (!view) return;
    renderView(view);
  });

  init();
</script>

</body>
</html>
